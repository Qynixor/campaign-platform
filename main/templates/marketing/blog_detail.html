{% extends 'marketing/geno.html' %}
{% load static %}

{% block meta %}
<title>{{ blog_post.meta_title|default:blog_post.title }} | Rallynex Blog</title>
<meta name="description" content="{{ blog_post.meta_description|default:blog_post.excerpt|truncatechars:155 }}">
{% if blog_post.canonical_url %}
<link rel="canonical" href="{{ blog_post.canonical_url }}">
{% else %}
<link rel="canonical" href="{{ request.build_absolute_uri }}">
{% endif %}
{% endblock %}

{% block content %}
<style>
/* ===== MODERN BLOG DESIGN WITH TINYMCE CONTENT STYLING ===== */
:root {
    --color-primary: #1a1a1a;
    --color-secondary: #404040;
    --color-accent: #1a8917;
    --color-light: #f8f9fa;
    --color-border: #eaeaea;
    --color-muted: #6c757d;
    --spacing-xs: 0.5rem;
    --spacing-sm: 1rem;
    --spacing-md: 1.5rem;
    --spacing-lg: 2rem;
    --spacing-xl: 3rem;
    --border-radius: 8px;
    --container-width: 768px;
    --mobile-padding: 1rem;
}

/* Reset box-sizing */
.blog-container * {
    box-sizing: border-box;
}

.blog-content-wrapper {
    position: relative;
    z-index: 1;
    background: #ffffff;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: var(--color-primary);
    line-height: 1.7;
    background: #ffffff;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
}

/* ===== MAIN LAYOUT ===== */
.blog-container {
    max-width: var(--container-width);
    margin: 0 auto;
    padding: 0 var(--spacing-md) var(--spacing-xl);
    position: relative;
    z-index: 2;
}

/* ===== ARTICLE HEADER ===== */
.article-header {
    padding: var(--spacing-xl) var(--spacing-md) var(--spacing-lg);
    text-align: center;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: var(--spacing-xl);
    position: relative;
    z-index: 1;
}

.category-tag {
    display: inline-block;
    padding: 6px 16px;
    background: rgba(26, 137, 23, 0.1);
    color: var(--color-accent);
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    margin-bottom: var(--spacing-md);
}

.article-title {
    font-size: 3rem;
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: var(--spacing-md);
    color: var(--color-primary);
    position: relative;
    z-index: 1;
}

.article-excerpt {
    font-size: 1.25rem;
    line-height: 1.6;
    color: var(--color-secondary);
    margin-bottom: var(--spacing-lg);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    position: relative;
    z-index: 1;
}

/* ===== AUTHOR INFO ===== */
.author-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-md);
    margin: var(--spacing-lg) 0;
    flex-wrap: wrap;
    position: relative;
    z-index: 1;
}

.author-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.author-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
}

.author-details {
    text-align: left;
}

.author-name {
    font-weight: 600;
    font-size: 16px;
}

.publish-date {
    font-size: 14px;
    color: var(--color-muted);
}

.article-stats {
    display: flex;
    gap: var(--spacing-md);
    color: var(--color-muted);
    font-size: 14px;
}

/* ===== FEATURED IMAGE ===== */
.featured-image-wrapper {
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    overflow: hidden;
}

.featured-image-container {
    position: relative;
    z-index: 1;
    max-width: 100%;
    height: auto;
}

.featured-image {
    width: 100%;
    height: auto;
    border-radius: 0;
    box-shadow: none;
    display: block;
    object-fit: cover;
}

/* ===== TINYMCE CONTENT STYLING ===== */
.article-body-wrapper {
    position: relative;
    z-index: 2;
    background: #ffffff;
}

.article-body {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-primary);
    margin-bottom: var(--spacing-xl);
    position: relative;
    z-index: 1;
    overflow: visible;
}

/* FIX: Ensure content is not hidden */
.article-body > * {
    position: relative;
    z-index: 1;
}

/* Headings - Override TinyMCE styles */
.article-body h1,
.article-body h2,
.article-body h3,
.article-body h4,
.article-body h5,
.article-body h6 {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    font-weight: 700;
    line-height: 1.3;
    margin: var(--spacing-lg) 0 var(--spacing-md);
    color: var(--color-primary);
    clear: both;
}

.article-body h1 {
    font-size: 2.5rem;
    border-bottom: 3px solid var(--color-accent);
    padding-bottom: var(--spacing-sm);
    margin-top: var(--spacing-xl);
}

.article-body h2 {
    font-size: 2rem;
    border-left: 4px solid var(--color-accent);
    padding-left: var(--spacing-md);
    margin-left: 0;
}

.article-body h3 {
    font-size: 1.75rem;
    color: var(--color-secondary);
}

.article-body h4 {
    font-size: 1.5rem;
    color: var(--color-secondary);
}

.article-body h5 {
    font-size: 1.25rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.article-body h6 {
    font-size: 1.125rem;
    color: var(--color-muted);
}

/* Paragraphs */
.article-body p {
    margin-bottom: var(--spacing-md);
    font-size: 1.125rem;
    line-height: 1.8;
}

/* Images from TinyMCE */
.article-body img {
    max-width: 100%;
    height: auto;
    border-radius: var(--border-radius);
    margin: var(--spacing-lg) 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: block;
}

/* Center aligned images */
.article-body img[style*="display: block; margin-left: auto; margin-right: auto;"],
.article-body img[style*="margin: 0 auto;"] {
    margin: var(--spacing-lg) auto !important;
}

/* Left/Right aligned images */
.article-body img[style*="float: left;"] {
    float: left;
    margin: var(--spacing-sm) var(--spacing-lg) var(--spacing-sm) 0 !important;
    max-width: 50%;
}

.article-body img[style*="float: right;"] {
    float: right;
    margin: var(--spacing-sm) 0 var(--spacing-sm) var(--spacing-lg) !important;
    max-width: 50%;
}

/* Lists */
.article-body ul,
.article-body ol {
    margin: var(--spacing-md) 0 var(--spacing-md) var(--spacing-lg);
    padding-left: var(--spacing-lg);
}

.article-body li {
    margin-bottom: var(--spacing-sm);
    font-size: 1.1rem;
    line-height: 1.6;
}

/* Custom bullet points */
.article-body ul {
    list-style: none;
}

.article-body ul li {
    position: relative;
    padding-left: var(--spacing-md);
}

.article-body ul li::before {
    content: "‚Ä¢";
    color: var(--color-accent);
    font-size: 1.5rem;
    position: absolute;
    left: 0;
    top: -2px;
}

/* Numbered lists */
.article-body ol {
    counter-reset: list-counter;
}

.article-body ol li {
    counter-increment: list-counter;
    position: relative;
    padding-left: var(--spacing-md);
}

.article-body ol li::before {
    content: counter(list-counter) ".";
    color: var(--color-accent);
    font-weight: 600;
    position: absolute;
    left: 0;
}

/* Blockquotes */
.article-body blockquote {
    border-left: 4px solid var(--color-accent);
    padding: var(--spacing-md) var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    background: var(--color-light);
    border-radius: 0 var(--border-radius) var(--border-radius) 0;
    font-style: italic;
    font-size: 1.25rem;
    line-height: 1.6;
    color: var(--color-secondary);
}

.article-body blockquote p:last-child {
    margin-bottom: 0;
}

/* Links */
.article-body a {
    color: var(--color-accent);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.2s;
}

.article-body a:hover {
    border-bottom-color: var(--color-accent);
}

/* Code blocks */
.article-body code {
    background: var(--color-light);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 0.9em;
    color: #d63384;
}

.article-body pre {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: var(--spacing-md);
    border-radius: var(--border-radius);
    overflow-x: auto;
    margin: var(--spacing-lg) 0;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.95rem;
    line-height: 1.5;
}

/* Tables */
.article-body table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--spacing-lg) 0;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.article-body thead {
    background: var(--color-accent);
    color: white;
}

.article-body th {
    padding: var(--spacing-md);
    text-align: left;
    font-weight: 600;
    font-size: 1rem;
}

.article-body td {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--color-border);
    font-size: 1rem;
}

.article-body tbody tr:hover {
    background: var(--color-light);
}

/* Horizontal rules */
.article-body hr {
    border: none;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-accent), transparent);
    margin: var(--spacing-xl) 0;
}

/* Text formatting */
.article-body strong {
    font-weight: 700;
    color: var(--color-primary);
}

.article-body em {
    font-style: italic;
    color: var(--color-secondary);
}

/* Text alignment */
.article-body .text-left {
    text-align: left !important;
}

.article-body .text-center {
    text-align: center !important;
}

.article-body .text-right {
    text-align: right !important;
}

/* Remove TinyMCE inline styles that might conflict */
.article-body [style*="font-family"] {
    font-family: inherit !important;
}

.article-body [style*="font-size"] {
    font-size: inherit !important;
}

.article-body [style*="color"]:not(.mce-item-table *) {
    color: inherit !important;
}

/* ===== KEY POINTS BOX ===== */
.key-points {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: var(--spacing-lg);
    border-radius: var(--border-radius);
    margin: var(--spacing-xl) 0;
    border-left: 4px solid var(--color-accent);
    position: relative;
    z-index: 1;
}

.key-points-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: var(--spacing-md);
    color: var(--color-primary);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.key-points ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.key-points li {
    margin-bottom: var(--spacing-sm);
    padding-left: var(--spacing-lg);
    position: relative;
    font-size: 1.1rem;
    line-height: 1.6;
}

.key-points li::before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: var(--color-accent);
    font-weight: bold;
    font-size: 1.2rem;
}

/* ===== SHARE SECTION ===== */
.share-section {
    margin: var(--spacing-xl) 0;
    padding: var(--spacing-lg);
    background: var(--color-light);
    border-radius: var(--border-radius);
    border: 1px solid var(--color-border);
    text-align: center;
    position: relative;
    z-index: 1;
}

.share-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-md);
    color: var(--color-muted);
}

.share-buttons {
    display: flex;
    gap: var(--spacing-sm);
    justify-content: center;
}

.share-button {
    padding: 10px 20px;
    border-radius: 6px;
    color: white;
    text-decoration: none;
    font-weight: 500;
    transition: transform 0.2s;
    position: relative;
    z-index: 1;
}

.share-button:hover {
    transform: translateY(-2px);
}

.twitter { background: #1da1f2; }
.facebook { background: #4267b2; }
.linkedin { background: #0077b5; }

/* ===== RELATED ARTICLES ===== */
.related-section {
    margin: var(--spacing-xl) 0;
    position: relative;
    z-index: 1;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: var(--spacing-lg);
    text-align: center;
}

.related-grid {
    display: grid;
    gap: var(--spacing-md);
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

.related-card {
    text-decoration: none;
    color: inherit;
    padding: var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    transition: all 0.3s;
    position: relative;
    z-index: 1;
    display: block;
    background: #ffffff;
}

.related-card:hover {
    border-color: var(--color-accent);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
}

.related-card-category {
    font-size: 12px;
    color: var(--color-accent);
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.related-card-title {
    font-size: 1.125rem;
    font-weight: 600;
    line-height: 1.4;
    margin-bottom: 8px;
}

.related-card-meta {
    font-size: 14px;
    color: var(--color-muted);
}

/* Clear floats */
.clearfix::after {
    content: "";
    clear: both;
    display: table;
}

/* ===== MOBILE RESPONSIVE STYLES ===== */
@media (max-width: 768px) {
    .blog-container {
        padding: 0 0 var(--spacing-lg);
        width: 100%;
        max-width: 100%;
    }
    
    .article-header {
        padding: var(--spacing-xl) var(--mobile-padding) var(--spacing-lg);
        margin-left: 0;
        margin-right: 0;
        width: 100%;
    }
    
    .article-body-wrapper {
        padding: 0 var(--mobile-padding);
    }
    
    .related-section {
        padding: 0 var(--mobile-padding);
    }
    
    .share-section {
        margin: var(--spacing-xl) var(--mobile-padding);
    }
    
    .key-points {
        margin: var(--spacing-xl) var(--mobile-padding);
    }
    
    .featured-image-wrapper {
        margin-top: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
    }
    
    .article-title {
        font-size: 2.25rem;
    }
    
    .article-excerpt {
        font-size: 1.125rem;
    }
    
    .article-body {
        font-size: 1.0625rem;
    }
    
    .article-body h1 {
        font-size: 2rem;
    }
    
    .article-body h2 {
        font-size: 1.75rem;
        margin-left: 0;
        padding-left: var(--spacing-sm);
    }
    
    .article-body h3 {
        font-size: 1.5rem;
    }
    
    /* Reset floated images on mobile */
    .article-body img[style*="float: left;"],
    .article-body img[style*="float: right;"] {
        float: none !important;
        margin: var(--spacing-lg) auto !important;
        max-width: 100% !important;
        display: block;
    }
    
    .author-meta {
        flex-direction: column;
        gap: var(--spacing-sm);
        padding: 0 var(--mobile-padding);
    }
    
    .share-buttons {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-sm);
    }
    
    .share-button {
        width: 100%;
        text-align: center;
    }
    
    .related-grid {
        grid-template-columns: 1fr;
        padding: 0;
    }
    
    .related-card {
        margin: 0 var(--mobile-padding);
        width: calc(100% - 2 * var(--mobile-padding));
    }
}

@media (max-width: 480px) {
    .article-title {
        font-size: 2rem;
    }
    
    .article-body h2 {
        font-size: 1.5rem;
    }
    
    .article-body h3 {
        font-size: 1.25rem;
    }
    
    /* Edge-to-edge images on mobile */
    .article-body img:not(.featured-image) {
        border-radius: 0;
        margin: var(--spacing-lg) calc(-1 * var(--mobile-padding)) !important;
        width: calc(100% + 2 * var(--mobile-padding)) !important;
        max-width: calc(100% + 2 * var(--mobile-padding)) !important;
    }
    
    /* Full-width tables on mobile */
    .article-body table {
        margin: var(--spacing-lg) calc(-1 * var(--mobile-padding));
        width: calc(100% + 2 * var(--mobile-padding));
        border-radius: 0;
        font-size: 0.9rem;
    }
    
    .article-body th,
    .article-body td {
        padding: var(--spacing-sm);
    }
    
    /* Edge-to-edge blockquotes */
    .article-body blockquote {
        margin: var(--spacing-lg) calc(-1 * var(--mobile-padding));
        padding: var(--spacing-md) var(--mobile-padding);
        border-radius: 0;
    }
    
    /* Code blocks edge-to-edge */
    .article-body pre {
        margin: var(--spacing-lg) calc(-1 * var(--mobile-padding));
        border-radius: 0;
        padding: var(--spacing-md);
    }
}

/* ===== LARGE SCREEN STYLES ===== */
@media (min-width: 769px) {
    .featured-image {
        border-radius: var(--border-radius);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .featured-image-wrapper {
        max-width: calc(var(--container-width) + 2 * var(--spacing-md));
        left: 0;
        right: 0;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
    }
    
    /* Better table display on desktop */
    .article-body table {
        max-width: 100%;
        overflow-x: visible;
    }
}

/* Print styles */
@media print {
    .article-body {
        font-size: 12pt;
        line-height: 1.5;
    }
    
    .share-section,
    .related-section,
    .key-points {
        display: none;
    }
    
    .article-body a {
        color: #000;
        text-decoration: underline;
    }
    
    .article-body img {
        max-width: 100% !important;
        page-break-inside: avoid;
    }
}
</style>

<div class="blog-content-wrapper">
    <div class="blog-container">
        <!-- Article Header -->
        <header class="article-header">
            <div class="category-tag">{{ blog_post.category }}</div>
            <h1 class="article-title">{{ blog_post.title }}</h1>
            
            {% if blog_post.excerpt %}
            <p class="article-excerpt">{{ blog_post.excerpt|safe  }}</p>
            {% endif %}
            
            <!-- Author & Meta Info -->
            <div class="author-meta">
                <div class="author-info">
                    {% if blog_post.author.profile.avatar %}
                    <img src="{{ blog_post.author.profile.avatar.url }}" 
                         alt="{{ blog_post.author.get_full_name }}"
                         class="author-avatar">
                    {% endif %}
                    <div class="author-details">
                        <div class="author-name">
                            {{ blog_post.author.get_full_name|default:blog_post.author.username }}
                        </div>
                        <div class="publish-date">
                            {{ blog_post.created_at|date:"F d, Y" }}
                        </div>
                    </div>
                </div>
                
                <div class="article-stats">
                    <span>‚è±Ô∏è {{ blog_post.estimated_reading_time }} min read</span>
                    <span>üìä {{ blog_post.word_count }} words</span>
                    <span>üëÅÔ∏è {{ blog_post.view_count }} views</span>
                </div>
            </div>
        </header>

        <!-- Featured Image -->
        {% if blog_post.featured_image %}
        <div class="featured-image-wrapper">
            <div class="featured-image-container">
                <img src="{{ blog_post.featured_image.url }}" 
                     alt="{{ blog_post.title }}"
                     class="featured-image"
                     loading="lazy">
            </div>
        </div>
        {% endif %}

        <!-- TINYMCE CONTENT -->
        <div class="article-body-wrapper">
            <div class="article-body clearfix">
                {{ blog_post.content|safe }}
            </div>
        </div>

        <!-- Key Points Section -->
        <div class="key-points">
            <div class="key-points-title">
                <span>üí°</span>
                <span>Key Takeaways</span>
            </div>
            <ul>
                <li>Start meaningful causes that matter to you and your community</li>
                <li>Share real progress updates to build trust and engagement</li>
                <li>Let supporters follow your journey and see actual impact</li>
                <li>Create transparent, trackable causes without organizational barriers</li>
            </ul>
        </div>

        <!-- Share Section -->
        <div class="share-section">
            <div class="share-title">Share this article</div>
            <div class="share-buttons">
                {% with share_url=request.build_absolute_uri share_title=blog_post.title|urlencode %}
                <a href="https://twitter.com/intent/tweet?url={{ share_url }}&text={{ share_title }}" 
                   class="share-button twitter"
                   target="_blank"
                   rel="noopener">
                    Twitter
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url }}"
                   class="share-button facebook"
                   target="_blank"
                   rel="noopener">
                    Facebook
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ share_url }}"
                   class="share-button linkedin"
                   target="_blank"
                   rel="noopener">
                    LinkedIn
                </a>
                {% endwith %}
            </div>
        </div>

        <!-- Related Articles -->
        {% if related_posts %}
        <section class="related-section">
            <h2 class="section-title">You might also like</h2>
            <div class="related-grid">
                {% for post in related_posts %}
                <a href="{% url 'blog_detail' post.slug %}" class="related-card">
                    <div class="related-card-category">{{ post.category }}</div>
                    <h3 class="related-card-title">{{ post.title }}</h3>
                    <div class="related-card-meta">
                        {{ post.created_at|date:"M d, Y" }} ‚Ä¢ {{ post.estimated_reading_time }} min read
                    </div>
                </a>
                {% endfor %}
            </div>
        </section>
        {% endif %}
    </div>
</div>

<script>
// Reading progress bar
document.addEventListener('DOMContentLoaded', function() {
    // Create progress bar
    const progressBar = document.createElement('div');
    progressBar.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, var(--color-accent), #2ecc71);
        transform-origin: 0%;
        transform: scaleX(0);
        transition: transform 0.1s;
        z-index: 9999;
        pointer-events: none;
    `;
    document.body.prepend(progressBar);

    // Update progress on scroll
    window.addEventListener('scroll', () => {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight - windowHeight;
        const scrolled = window.scrollY;
        
        if (documentHeight > 0) {
            const progress = Math.min(scrolled / documentHeight, 1);
            progressBar.style.transform = `scaleX(${progress})`;
        }
    });

    // Smooth scrolling for anchor links
    document.querySelectorAll('.article-body a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            const targetId = this.getAttribute('href');
            if (targetId !== '#') {
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    e.preventDefault();
                    window.scrollTo({
                        top: targetElement.offsetTop - 100,
                        behavior: 'smooth'
                    });
                }
            }
        });
    });

    // Handle floated images on mobile
    function handleFloatedImages() {
        if (window.innerWidth <= 768) {
            document.querySelectorAll('.article-body img[style*="float"]').forEach(img => {
                img.style.cssText = `
                    float: none !important;
                    margin: ${getComputedStyle(document.documentElement).getPropertyValue('--spacing-lg')} auto !important;
                    max-width: 100% !important;
                    display: block;
                `;
            });
        }
    }

    // Handle images on load and resize
    function handleImages() {
        if (window.innerWidth <= 480) {
            document.querySelectorAll('.article-body img:not(.featured-image)').forEach(img => {
                img.style.maxWidth = '100vw';
                img.style.width = '100vw';
                img.style.marginLeft = 'calc(-1 * var(--mobile-padding))';
                img.style.marginRight = 'calc(-1 * var(--mobile-padding))';
                img.style.borderRadius = '0';
            });
        } else {
            document.querySelectorAll('.article-body img:not(.featured-image)').forEach(img => {
                img.style.maxWidth = '';
                img.style.width = '';
                img.style.marginLeft = '';
                img.style.marginRight = '';
                img.style.borderRadius = 'var(--border-radius)';
            });
        }
        handleFloatedImages();
    }

    window.addEventListener('resize', handleImages);
    handleImages(); // Run on load

    // Fix for TinyMCE content with tables on mobile
    function fixTablesOnMobile() {
        if (window.innerWidth <= 480) {
            document.querySelectorAll('.article-body table').forEach(table => {
                table.style.marginLeft = 'calc(-1 * var(--mobile-padding))';
                table.style.marginRight = 'calc(-1 * var(--mobile-padding))';
                table.style.width = 'calc(100% + 2 * var(--mobile-padding))';
            });
        }
    }
    
    window.addEventListener('resize', fixTablesOnMobile);
    fixTablesOnMobile();

    // View count increment (optional)
    {% if blog_post.id %}
    // You can add AJAX call here to increment view count
    // fetch(`/api/blog/{{ blog_post.id }}/view/`, { method: 'POST' });
    {% endif %}

    // Lazy load images
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    }
                    observer.unobserve(img);
                }
            });
        });

        document.querySelectorAll('.article-body img[data-src]').forEach(img => {
            imageObserver.observe(img);
        });
    }
});

// Share button functionality
function shareOnPlatform(platform) {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    
    const shareUrls = {
        twitter: `https://twitter.com/intent/tweet?url=${url}&text=${title}`,
        facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
        linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${url}`
    };
    
    if (shareUrls[platform]) {
        window.open(shareUrls[platform], '_blank', 'width=600,height=400');
    }
}

// Add copy link functionality
function copyToClipboard() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        alert('Link copied to clipboard!');
    });
}
</script>
{% endblock %}