{% extends 'main/face.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
        <meta name="color-scheme" content="light dark">
    <style>

        :root {
            --primary: #1da1f2;
            --primary-dark: #1a91da;
            --primary-light: #e8f5fe;
            --secondary: #f5f8fa;
            --text-primary: #14171a;
            --text-secondary: #657786;
            --border: #e1e8ed;
            --card-bg: #ffffff;
            --success: #17bf63;
            --error: #e0245e;
            --warning: #ffad1f;
            --card-shadow: 0 2px 16px rgba(29, 161, 242, 0.08);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --accent-gradient: linear-gradient(135deg, #1da1f2 0%, #1a8cd8 100%);
        }
       /* === DARK MODE - FIXED VERSION === */
.dark-mode {
    /* Colors: Use dark grey, not pure black, with light grey text */
    --primary: #1da1f2;
    --primary-dark: #1a91da;
    --primary-light: rgba(29, 161, 242, 0.2);
    --secondary: #0f1720; /* Darker base background */
    --text-primary: #e8e8e8; /* Light grey, not pure white */
    --text-secondary: #a0aec0; /* Softer secondary text */
    --border: #2d3748; /* Darker borders */
    --card-bg: #1e2736; /* Dark grey for cards */
    --accent-gradient: linear-gradient(135deg, #1da1f2 0%, #1a8cd8 100%);

    /* Crucial: Inform the browser to handle form controls */
    color-scheme: dark;
}

/* Ensure form controls are styled explicitly */
.dark-mode .form-input,
.dark-mode .form-select,
.dark-mode .form-textarea {
    background-color: #2d3748; /* Explicit dark background */
    border-color: var(--border);
    color: var(--text-primary); /* Explicit light text */
}

.dark-mode .form-input:focus,
.dark-mode .form-select:focus,
.dark-mode .form-textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(29, 161, 242, 0.3);
}

.dark-mode .file-upload {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--border);
}

.dark-mode .create-card,
.dark-mode .optional-section,
.dark-mode .welcome-message {
    background-color: var(--card-bg);
    border-color: var(--border);
} 

/* ===== DARK MODE FOR OPTIONAL HEADER ===== */
.dark-mode .optional-header {
    background: #2d3748; /* Dark grey background */
    border-bottom-color: var(--border);
    color: var(--text-primary); /* Light text */
}

.dark-mode .optional-header:hover {
    background: #374151; /* Slightly lighter on hover */
}

.dark-mode .optional-header h3 {
    color: var(--text-primary); /* Ensures the text is light */
}

.dark-mode .optional-header i {
    color: var(--text-secondary); /* Cheveron icon in softer color */
}
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--secondary);
            color: var(--text-primary);
            line-height: 1.5;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .create-wrapper {
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .create-container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
        }
        
        /* === HEADER - STEP 2 === */
        .create-header {
            text-align: center;
            margin-bottom: 32px;
            padding: 0 16px;
        }
        
        .create-header h1 {
            margin: 0 0 8px 0;
            color: var(--text-primary);
            font-weight: 800;
            font-size: 32px;
            line-height: 1.2;
        }
        
        .create-header p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 17px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        /* === CORE FORM - STEP 1 === */
        .core-form {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 32px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 15px;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: inherit;
            font-size: 16px;
            background-color: white;
            box-sizing: border-box;
            transition: var(--transition);
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(29, 161, 242, 0.1);
        }
        
        .form-textarea {
            min-height: 140px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .form-helper {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 6px;
            display: block;
        }
        
        /* === OPTIONAL SECTION - STEP 4 === */
        .optional-section {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            padding: 0;
            margin-bottom: 24px;
            border: 1px solid var(--border);
            overflow: hidden;
        }
        
        .optional-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8fafc;
        }
        
        .optional-header:hover {
            background: #f0f5fa;
        }
        
        .optional-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .optional-header i {
            transition: transform 0.2s ease;
            color: var(--primary);
        }
        
        .optional-header.expanded i {
            transform: rotate(180deg);
        }
        
        .optional-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .optional-content.expanded {
            padding: 24px;
            max-height: 2000px;
        }
        
        .optional-field {
            margin-bottom: 20px;
        }
        
        /* === PUBLISH BUTTON - STEP 6 === */
        .publish-section {
            text-align: center;
            margin-top: 32px;
        }
        
        .publish-button {
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 48px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(29, 161, 242, 0.2);
        }
        
        .publish-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(29, 161, 242, 0.3);
        }
        
        .reassurance-text {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 12px;
            display: block;
        }
        
        /* === ERROR HANDLING === */
        .error-container {
            background-color: rgba(224, 36, 94, 0.05);
            border-left: 4px solid var(--error);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            color: var(--error);
            font-size: 14px;
        }
        
        .error-container strong {
            display: block;
            margin-bottom: 8px;
        }
        
        .error-container ul {
            margin: 0;
            padding-left: 20px;
        }
        
        /* === PROFILE STATUS === */
        .profile-status {
            background: rgba(29, 161, 242, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            text-align: center;
            border: 1px solid rgba(29, 161, 242, 0.2);
        }
        
        .profile-status a {
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-status a:hover {
            text-decoration: underline;
        }
        
        /* === IMAGE PREVIEW === */
        .image-previews {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .image-preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border);
            aspect-ratio: 1;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .create-wrapper {
                padding: 16px 12px;
            }
            
            .core-form, .optional-section {
                padding: 24px;
            }
            
            .create-header h1 {
                font-size: 28px;
            }
        }
        
        /* === TWO COLUMN LAYOUT FOR OPTIONAL === */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        @media (max-width: 640px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
        
        /* === FILE UPLOAD === */
        .file-upload {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #fafbfd;
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }
        
        .file-upload i {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 12px;
        }
        
        .file-upload-text {
            font-size: 15px;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        /* === AUDIO PREVIEW === */
        .audio-preview {
            margin-top: 16px;
        }
        
        .audio-preview audio {
            width: 100%;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    
<div class="create-wrapper">
    <div class="create-container">
        
        <!-- STEP 2: Simple header -->
        <div class="create-header">
            <h1>Share something you care about</h1>
            <p>People can follow and support as you make progress.</p>
        </div>
        
        <!-- Profile status -->
        {% if not user_profile.has_paypal %}
        <div class="profile-status">
            <a href="{% url 'edit_profile' username=user_profile.user.username %}">
                <i class="fas fa-plus-circle"></i> Add PayPal to receive support
            </a>
        </div>
        {% endif %}
        
        <!-- Main form -->
        <form method="post" enctype="multipart/form-data" id="campaignForm">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="error-container">
                <strong>Let's fix a few things:</strong>
                <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- STEP 1: CORE FORM - Always visible -->
            <div class="core-form">
                <!-- Title - STEP 3 -->
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text"
                           name="title"
                           class="form-input"
                           placeholder="What are you trying to change?"
                           required
                           value="{{ form.title.value|default:'' }}">
                </div>
                
                <!-- Description - STEP 3 -->
                <div class="form-group">
                    <label class="form-label">What's going on?</label>
                    <textarea name="content"
                              class="form-textarea"
                              placeholder="Tell people what's happening and what you're trying to do."
                              required>{{ form.content.value|default:'' }}</textarea>
                </div>
                
                <!-- Category - STEP 3 -->
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select name="category" class="form-select" required>
                        {% for category in categories %}
                            <option value="{{ category.0 }}"
                                {% if form.category.value == category.0 %}selected{% endif %}>
                                {{ category.1 }}
                            </option>
                        {% endfor %}
                    </select>
                    <span class="form-helper">Helps people find your cause</span>
                </div>
            </div>
            
            <!-- STEP 4: OPTIONAL SECTION - Collapsed by default -->
            <div class="optional-section">
                <div class="optional-header" id="optionalToggle">
                    <h3>▸ Add more details (optional)</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div class="optional-content" id="optionalContent">
                    <!-- Images -->
                    <div class="optional-field">
                        <label class="form-label">Images</label>
                        <div class="file-upload">
                            <label for="id_poster">
                                <i class="fas fa-image"></i>
                                <div class="file-upload-text">Upload a main image</div>
                            </label>
                            {{ form.poster }}
                        </div>
                        <div id="mainPosterPreview" class="image-previews"></div>
                        
                        <div style="margin-top: 16px;">
                            <div class="file-upload">
                                <label for="id_additional_images">
                                    <i class="fas fa-layer-group"></i>
                                    <div class="file-upload-text">Add more images</div>
                                </label>
                                {{ form.additional_images }}
                            </div>
                        </div>
                        <div id="additionalPreviews" class="image-previews"></div>
                    </div>
                    
                    <!-- Audio -->
                    <div class="optional-field">
                        <label class="form-label">Add audio</label>
                        <div class="file-upload">
                            <label for="id_audio">
                                <i class="fas fa-music"></i>
                                <div class="file-upload-text">Upload audio clip</div>
                            </label>
                            {{ form.audio }}
                        </div>
                        <div id="audioPreview" class="audio-preview"></div>
                    </div>
                    
                    <!-- Visibility & Tags -->
                    <div class="two-column">
                        <div class="optional-field">
                            <label class="form-label">Visibility</label>
                            <select name="visibility" class="form-select">
                                <option value="public">Public</option>
                                <option value="private">Private (invite only)</option>
                            </select>
                        </div>
                        
                        <div class="optional-field">
                            <label class="form-label">Tags</label>
                            <input type="text"
                                   name="tags_input"
                                   class="form-input"
                                   placeholder="environment, education, health..."
                                   value="{{ form.tags_input.value|default:'' }}">
                        </div>
                    </div>
                    
                    <!-- Timeframe -->
                    <div class="optional-field">
                        <label class="form-label">Timeframe</label>
                        <div class="two-column">
                            <input type="number"
                                   name="duration"
                                   class="form-input"
                                   min="1"
                                   placeholder="e.g. 30"
                                   value="{{ form.duration.value|default:'' }}">
                            <select name="duration_unit" class="form-select">
                                <option value="">No limit</option>
                                <option value="days">Days</option>
                                <option value="weeks">Weeks</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Funding Goal -->
                    <div class="optional-field">
                        <label class="form-label">Funding goal</label>
                        <input type="number"
                               name="funding_goal"
                               class="form-input"
                               min="0"
                               step="0.01"
                               placeholder="0.00"
                               value="{{ form.funding_goal.value|default:'' }}">
                    </div>
                </div>
            </div>
            
            <!-- STEP 6 & 8: Publish button with reassurance -->
            <div class="publish-section">
                <button type="submit" class="publish-button">
                    Publish
                </button>
                <span class="reassurance-text">You can edit everything later</span>
            </div>
        </form>
    </div>
</div>

<script>
    // STEP 4: Toggle optional section
    document.getElementById('optionalToggle').addEventListener('click', function() {
        const content = document.getElementById('optionalContent');
        const icon = this.querySelector('i');
        
        content.classList.toggle('expanded');
        this.classList.toggle('expanded');
        
        // Update arrow icon
        if (content.classList.contains('expanded')) {
            this.querySelector('h3').innerHTML = '▾ Add more details (optional)';
        } else {
            this.querySelector('h3').innerHTML = '▸ Add more details (optional)';
        }
    });
    
    // Image preview functionality (same as before)
    let additionalImages = [];
    
    function previewMainImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('mainPosterPreview');
                preview.innerHTML = `
                    <div class="image-preview-item">
                        <img src="${e.target.result}" alt="Main poster">
                        <button type="button" class="remove-image" onclick="clearMainImage()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
    }
    
    function clearMainImage() {
        document.querySelector('input[name="poster"]').value = '';
        document.getElementById('mainPosterPreview').innerHTML = '';
    }
    
    function previewAdditionalImages(event) {
        const files = Array.from(event.target.files);
        const previewContainer = document.getElementById('additionalPreviews');
        
        files.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.className = 'image-preview-item';
                div.innerHTML = `
                    <img src="${e.target.result}" alt="Additional image">
                    <button type="button" class="remove-image" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(div);
            };
            reader.readAsDataURL(file);
        });
    }
    
    // Audio preview
    function previewAudio(event) {
        const file = event.target.files[0];
        if (file) {
            const preview = document.getElementById('audioPreview');
            const url = URL.createObjectURL(file);
            preview.innerHTML = `
                <audio controls src="${url}"></audio>
                <div style="margin-top: 8px; font-size: 14px; color: var(--text-secondary)">
                    <i class="fas fa-check-circle"></i> ${file.name}
                </div>
            `;
        }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Setup image previews
        const posterInput = document.querySelector('input[name="poster"]');
        if (posterInput) posterInput.addEventListener('change', previewMainImage);
        
        const additionalInput = document.querySelector('input[name="additional_images"]');
        if (additionalInput) {
            additionalInput.addEventListener('change', previewAdditionalImages);
            additionalInput.setAttribute('multiple', true);
        }
        
        // Setup audio preview
        const audioInput = document.querySelector('input[name="audio"]');
        if (audioInput) audioInput.addEventListener('change', previewAudio);
        
        // STEP 8: Auto-save simulation (you can implement real auto-save later)
        const form = document.getElementById('campaignForm');
        const fields = form.querySelectorAll('input, textarea, select');
        
        fields.forEach(field => {
            field.addEventListener('input', function() {
                // In a real implementation, save to localStorage or send to server
                console.log('Auto-saving...');
            });
        });
    });
</script>

</body>
</html>
{% endblock content %}